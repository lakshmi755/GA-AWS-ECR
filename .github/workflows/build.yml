name: Build to AWS ECR
on:
  push:
    branches: [main]
jobs:
      login-to-aws:
         runs-on: ubuntu-latest
         steps:
         - name: Code Checkout
           uses: actions/checkout@v4

         - name: "Configure AWS Credentials"
           uses: aws-actions/configure-aws-credentials@v4.1.0           
           with:   
            aws-access-key-id: ${{ secrets.ACCESS_KEY }}
            aws-secret-access-key: ${{ secrets.SECRET_ACCESS_KEY }}
            aws-region: ${{ secrets.REGION }}

      build-and-push-pub-ecr:
            runs-on: ubuntu-latest
            steps:
            - name: Code Checkout
              uses: actions/checkout@v4

            - name: "Login to AWSECR"
              uses: docker/login-action@v3.4.0
              with:
               registry: 392848575587.dkr.ecr.ap-south-1.amazonaws.com
               username: ${{ secrets.ACCESS_KEY }}
               password: ${{ secrets.SECRET_ACCESS_KEY }}
              env:
               aws-region: ${{ secrets.REGION }}
            - name: Build Image
              run:
                docker build -t ecommrepo .
                docker tag ecommrepo:latest 392848575587.dkr.ecr.ap-south-1.amazonaws.com/ecommrepo:${BUILD_ID}
                docker push 392848575587.dkr.ecr.ap-south-1.amazonaws.com/ecommrepo:${BUILD_ID}


            


